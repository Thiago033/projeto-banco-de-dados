<% layout('layouts/boilerplate') %>

<div class="card mb-3 d-flex flex-column">
    <div class="row">
        <div class="col-md-4">
            <img class="img-fluid" src="<%= book.capa %> " alt="...">
        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h2 class="card-title mb-3"> <%= book.titulo %> </h2>
                <p class="card-text">
                    <small class="text-muted"> <%= book.descricao %> </small>
                </p>
                <p class="card-text"> <%= book.autor %> </p>
                <p class="card-text"> <%= book.idioma %> </p>

                
                <p class="card-text">
                    <small class="text-muted">ISBN: <%= book.isbn %> </small>
                </p>

                <h5 class="card-text"> $<%= book.preco %> </h5>
            </div>
        </div>
    </div>
</div>

<h4>Livros restantes no estoque: <%= book.quantidade %> </h4>
        
<div class="d-flex justify-content-center">
    <form action="/pedidos" class="needs-validation" method="POST" id="myForm" onsubmit="event.preventDefault(); validateMyForm(<%= book.quantidade %>);">
        <div class="row">

            <div class="col-5">
                <input type="hidden" name="isbn" value="<%= book.isbn %>">
                <input class="form-control" type="number" name="quantidade" id="quantidade" placeholder="Quantidade" required min="1">
            </div>
        
            <div class="col-7">
                <button class="btn btn-success mb-2" type="submit">Order book</button>
            </div>

        </div>
    </form>
</div>

<a href="/book/<%= book.isbn %>/edit " class="card-link btn btn-primary">Edit book</a>

<form class="d-inline" action="/book/<%=book.isbn%>?_method=DELETE" method="POST">
    <button class="btn btn-danger">Delete</button>
</form>



<script>

    function validateMyForm(quantidadeLivros) {

        var qtd = document.getElementById("quantidade").value;
        qtd = quantidadeLivros - qtd;

        if (qtd < 0){
            alert("Sem mais livros no estoque!");
            return false;
        }

        document.getElementById("myForm").submit();
        return true;
    }
</script>